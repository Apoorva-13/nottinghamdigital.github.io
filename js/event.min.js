var NDEvent=function(t){this.apiUrl=t.api,this.events=[],this.cache=!1,this.isLocalStorageAvailable&&(this.cache=window.localStorage,this.refreshCache())};NDEvent.prototype.isLocalStorageAvailable=function(t){try{var e=window[t],a="__storage_test__";return e.setItem(a,a),e.removeItem(a),!0}catch(t){return!1}},NDEvent.prototype.renderEvents=function(t){var e=this;t.each(function(t,a){var r=$.trim($(a).html());if(e.getByGroup(r)){var n=e.getByGroup(r),i=n.date_time;if(""!=i){i=i.replace("at ","");var o=moment(i,"dddd Do MMMM YYYY h:mma").format("Do MMMM");$(a).parent().parent().find(".event__date").append(' â€” Next: <a class="event__next" href="'+n.event_url+'" title="'+n.date_time+'">'+o+"</a>"),$(a).parent().parent().attr("data-isodate",n.iso_date)}}})},NDEvent.prototype.getByGroup=function(t){return this.isCached(t)||this.fetchGroup(t),this.getEvent(t)},NDEvent.prototype.fetchGroup=function(t){var e=this;$.ajax({method:"GET",url:this.apiUrl,data:{group:t}}).done(function(a){a&&e.addEvent(t,a)})},NDEvent.prototype.addEvent=function(t,e){this.cache?this.isCached(t)||this.cache.setItem(t,JSON.stringify(e)):this.events[t]=JSON.stringify(e)},NDEvent.prototype.getEvent=function(t){return!this.cache&&t in this.events?this.events[t]:this.getFromCache(t)},NDEvent.prototype.isCached=function(t){return this.cache?!!this.cache.getItem(t):t in this.events},NDEvent.prototype.getFromCache=function(t){if(this.isCached(t))return JSON.parse(this.cache.getItem(t))},NDEvent.prototype.refreshCache=function(){if(!this.cache)return!1;this.cache.getItem("expiry")?new Date>Date.parse(this.cache.getItem("expiry"))&&(this.cache.clear(),this.cache.setItem("expiry",new Date((new Date).getTime()+36e5))):this.cache.setItem("expiry",new Date((new Date).getTime()+36e5))},NDEvent.prototype.load=function(t){var e=this;t.forEach(function(t){e.getByGroup(t)})},NDEvent.prototype.addFilter=function(){var t=$('<ul class="filters"></ul>');$(".header").append(t),["all","tech","design","ops"].forEach(function(e){var a='<li class="filter filter--'+e+' " data-filter="'+e+'"><span>'+e.split(" ").map(function(t){return t.slice(0,1).toUpperCase()+t.slice(1).toLowerCase()}).join(" ")+"</span></li>";t.append(a)}),$firstItem=$(t.children()[0]).addClass("filter--active"),this.addFilterListener()},NDEvent.prototype.addFilterListener=function(){$("[data-filter]").on("click",function(t){t.preventDefault();var e=$(this).data("filter");$(".filter").removeClass("filter--active").filter('[data-filter="'+e+'"]').addClass("filter--active"),"all"==e?$(".event").show():$(".event").hide().filter('[data-theme="'+e+'"]').show()})},NDEvent.prototype.sortByDate=function(){var t=$.makeArray($(".events").find(".event")),e=t.filter(function(t){return $(t).data("isodate")}),a=t.filter(function(t){return!$(t).data("isodate")});e.sort(function(t,e){var t=new Date($(t).data("isodate")),e=new Date($(e).data("isodate"));return t<e?-1:t>e?1:0}),a.sort(function(t,e){var t=$(t).find(".org").text().toLowerCase(),e=$(e).find(".org").text().toLowerCase();return t<e?-1:t>e?1:0}),t=a.reverse().concat(e.reverse()),t.forEach(function(t){$(".events").prepend($(t))})},NDEvent.prototype.resetOrderText=function(){$(".order").text(function(){return $(this).text().replace("alphabetically","by next up")})},function(t){var arguments={api:"https://notts-digital.phpminds.uk/index.php"},e=new NDEvent(arguments),a=t(".vcard .url"),r=a.map(function(){return t.trim(t(this).text())}).get();e.load(r),t.ajax(),t(document).ajaxStop(function(){e.renderEvents(a),e.sortByDate(),e.resetOrderText()}),e.addFilter()}(jQuery);