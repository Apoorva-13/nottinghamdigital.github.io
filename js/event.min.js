var NDEvent=function(a){this.apiUrl=a.api,this.events=[],window.localStorage?(this.cache=window.localStorage,this.refreshCache()):this.cache=!1};NDEvent.prototype.renderEvents=function(a){var b=this;a.each(function(a,c){var d=$.trim($(c).html());if(b.getByGroup(d)&&b.getByGroup(d).group){var e=b.getByGroup(d),f=e.date_time;if(""!=f){f=f.replace("at ","");var g=moment(f,"dddd Do MMMM YYYY h:mma").format("Do MMMM");$(c).parent().parent().find(".event__date").append(' â€” Next: <a class="event__next" href="'+e.event_url+'" title="'+e.date_time+'">'+g+"</a>"),$(c).parent().parent().attr("data-isodate",e.iso_date)}}})},NDEvent.prototype.getByGroup=function(a){return this.isCached(a)||this.fetchGroup(a),this.getEvent(a)},NDEvent.prototype.fetchGroup=function(a){var b=this;$.ajax({method:"GET",url:this.apiUrl,data:{group:a}}).done(function(c){c&&b.addEvent(a,c)})},NDEvent.prototype.addEvent=function(a,b){this.cache?this.isCached(a)||this.cache.setItem(a,JSON.stringify(b)):this.events[a]=JSON.stringify(b)},NDEvent.prototype.getEvent=function(a){return!this.cache&&a in this.events?this.events[a]:this.getFromCache(a)},NDEvent.prototype.isCached=function(a){return this.cache?!!this.cache.getItem(a):a in this.events},NDEvent.prototype.getFromCache=function(a){if(this.isCached(a))return JSON.parse(this.cache.getItem(a))},NDEvent.prototype.refreshCache=function(){return!!this.cache&&void(this.cache.getItem("expiry")?new Date>Date.parse(this.cache.getItem("expiry"))&&(this.cache.clear(),this.cache.setItem("expiry",new Date((new Date).getTime()+864e5))):this.cache.setItem("expiry",new Date((new Date).getTime()+864e5)))},NDEvent.prototype.load=function(a){var b=this;a.forEach(function(a){b.getByGroup(a)})},NDEvent.prototype.addFilter=function(){var a=$('<ul class="filters"></ul>');$(".header").append(a);var b=["all","tech","design","ops"];b.forEach(function(b){var c='<li class="filter filter--'+b+' " data-filter="'+b+'"><span>'+b.split(" ").map(function(a){return a.slice(0,1).toUpperCase()+a.slice(1).toLowerCase()}).join(" ")+"</span></li>";a.append(c)}),$firstItem=$(a.children()[0]).addClass("filter--active"),this.addFilterListener()},NDEvent.prototype.addFilterListener=function(){$("[data-filter]").on("click",function(a){a.preventDefault();var b=$(this).data("filter");$(".filter").removeClass("filter--active").filter('[data-filter="'+b+'"]').addClass("filter--active"),"all"==b?$(".event").show():$(".event").hide().filter('[data-theme="'+b+'"]').show()})},NDEvent.prototype.sortByDate=function(){var a=$.makeArray($(".events").find(".event")),b=a.filter(function(a){return $(a).data("isodate")}),c=a.filter(function(a){return!$(a).data("isodate")});b.sort(function(a,b){var a=new Date($(a).data("isodate")),b=new Date($(b).data("isodate"));return a<b?-1:a>b?1:0}),c.sort(function(a,b){var a=$(a).find(".org").text().toLowerCase(),b=$(b).find(".org").text().toLowerCase();return console.log(a,b),a<b?-1:a>b?1:0}),a=c.reverse().concat(b.reverse()),a.forEach(function(a){$(".events").prepend($(a))})},function(a){var arguments={api:"https://notts-digital.pavlakis.info/index.php"},b=new NDEvent(arguments),c=a(".vcard .url"),d=c.map(function(){return a.trim(a(this).text())}).get();b.load(d),a.ajax(),a(document).ajaxStop(function(){b.renderEvents(c),b.sortByDate()}),b.addFilter()}(jQuery);